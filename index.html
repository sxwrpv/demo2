<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon-like Web3 Marketplace</title>
    <style>
        /* Basic Styling */
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        .header-top { display: flex; justify-content: space-between; padding: 10px 20px; background: #232f3e; color: white; }
        .logo { font-size: 20px; font-weight: bold; }
        .nav-items a { color: white; margin-left: 15px; text-decoration: none; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; padding: 20px; }
        .product-card { border: 1px solid #ddd; padding: 10px; text-align: center; background: white; }
        .cart-modal { position: fixed; top: 0; right: 0; width: 300px; height: 100%; background: white; padding: 20px; box-shadow: -2px 0 10px rgba(0,0,0,0.2); display: none; }
        .checkout-btn { background: #ff9900; color: white; padding: 10px; border: none; cursor: pointer; width: 100%; }
    </style>
</head>
<body>
    <header>
        <div class="header-top">
            <div class="logo">Web3 Marketplace</div>
            <div class="nav-items">
                <a href="#" onclick="openCart()">Cart (<span id="cartCount">0</span>)</a>
                <a href="#" onclick="connectWallet()">Connect Wallet</a>
            </div>
        </div>
    </header>
    
    <main>
        <h2 style="text-align:center">Today's Deals</h2>
        <div class="product-grid" id="productGrid"></div>
    </main>

    <div id="cartModal" class="cart-modal">
        <h3>Your Cart</h3>
        <div id="cartItems"></div>
        <button class="checkout-btn" onclick="checkout()">Checkout with Crypto</button>
        <button onclick="closeCart()">Close</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
    <script>
        let web3;
        let connectedAccount;
        let cart = [];
        const products = [
            { id: 1, name: "Laptop", price: 1000, image: "https://via.placeholder.com/150" },
            { id: 2, name: "Phone", price: 800, image: "https://via.placeholder.com/150" },
            { id: 3, name: "Headphones", price: 200, image: "https://via.placeholder.com/150" }
        ];

        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
                    connectedAccount = accounts[0];
                    alert("Wallet Connected: " + connectedAccount);
                } catch (error) {
                    console.error("User denied wallet connection", error);
                }
            } else {
                alert("Please install MetaMask!");
            }
        }

        function renderProducts() {
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = products.map(product => `
                <div class="product-card">
                    <img src="${product.image}" alt="${product.name}">
                    <h3>${product.name}</h3>
                    <p>$${product.price}</p>
                    <button onclick="addToCart(${product.id})">Add to Cart</button>
                </div>
            `).join('');
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            cart.push(product);
            document.getElementById('cartCount').innerText = cart.length;
        }

        function openCart() {
            document.getElementById('cartModal').style.display = 'block';
            document.getElementById('cartItems').innerHTML = cart.map(item => `<p>${item.name} - $${item.price}</p>`).join('');
        }

        function closeCart() {
            document.getElementById('cartModal').style.display = 'none';
        }

        async function checkout() {
            if (!connectedAccount) {
                alert("Please connect your wallet first.");
                return;
            }
            const totalPrice = cart.reduce((sum, item) => sum + item.price, 0);
            try {
                await web3.eth.sendTransaction({
                    from: connectedAccount,
                    to: "0xADdC9EafA31d0CeaB35d88Bed4657f77a47c55e8",
                    value: web3.utils.toWei((totalPrice / 2000).toFixed(6), 'ether')
                });
                alert("Payment Successful!");
                cart = [];
                document.getElementById('cartCount').innerText = 0;
                closeCart();
            } catch (error) {
                alert("Payment Failed: " + error.message);
            }
        }

        window.onload = renderProducts;
    </script>
</body>
</html>
